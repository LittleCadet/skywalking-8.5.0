(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-1c6a1da2"],{"2ab8":function(t,e,a){"use strict";var n=a("8faf");a.n(n).a},"35d2":function(t,e,a){},"3e56":function(t,e,a){"use strict";a("28a5"),a("55dd");var n=a("75fc"),s=a("cebc"),r=(a("7514"),a("20d6"),a("ac6a"),a("b6d0")),i=a.n(r),c=a("774e"),o=a.n(c),l=a("5d73"),d=a.n(l),p=a("d0ab"),u=[{label:"method",value:"Span"},{label:"start-time",value:"Start Time"},{label:"exec-ms",value:"Exec(ms)"},{label:"exec-percent",value:"Exec(%)"},{label:"self",value:"Self(ms)"},{label:"api",value:"API"},{label:"application",value:"Service"},{label:"application",value:"Operation"}],h=[{label:"method",value:"Method"},{label:"start-time",value:"Start Time"},{label:"exec-ms",value:"Exec(ms)"},{label:"exec-percent",value:"Exec(%)"},{label:"self",value:"Self(ms)"},{label:"api",value:"API"},{label:"application",value:"Service"}],m={name:"item",props:["data","type","method"],watch:{data:function(){var t=document.querySelectorAll(".trace-item"),e=!0,a=!1,n=void 0;try{for(var s,r=d()(t);!(e=(s=r.next()).done);e=!0){s.value.style.background="#fff"}}catch(t){a=!0,n=t}finally{try{e||null==r.return||r.return()}finally{if(a)throw n}}}},data:function(){return{displayChildren:!0,selectedSpan:0}},computed:{selfTime:function(){var t=this.data;return t.dur?t.dur:0},execTime:function(){var t=this.data;return t.endTime-t.startTime?t.endTime-t.startTime:0},outterPercent:function(){if(1===this.data.level)return"100%";var t=this.data,e=(t.endTime-t.startTime?t.endTime-t.startTime:0)/t.totalExec*100;return"0.0000%"===(e=(e=e>100?100:e).toFixed(4)+"%")?"0.9%":e},innerPercent:function(){var t=this.selfTime/this.execTime*100..toFixed(4)+"%";return"0.0000%"===t?"0.9%":t}},methods:{toggle:function(){this.displayChildren=!this.displayChildren},showSelectSpan:function(){var t=document.querySelectorAll(".trace-item"),e=!0,a=!1,n=void 0;try{for(var s,r=d()(t);!(e=(s=r.next()).done);e=!0){s.value.style.background="#fff"}}catch(t){a=!0,n=t}finally{try{e||null==r.return||r.return()}finally{if(a)throw n}}this.$refs.traceItem.style.background="rgba(0, 0, 0, 0.1)",this.$eventBus.$emit("HANDLE-SELECT-SPAN",this.data)},viewSpanDetail:function(){this.showSelectSpan(),this.$eventBus.$emit("HANDLE-VIEW-SPAN",this.data)}}},v=(a("9c62"),a("2877")),f={components:{Item:Object(v.a)(m,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{ref:"traceItem",class:["trace-item","level"+(t.data.level-1)].concat({"trace-item-error":t.data.isError}),on:{click:t.showSelectSpan}},[a("div",{class:["method","level"+(t.data.level-1)],style:{"text-indent":10*(t.data.level-1)+"px",width:t.method+"px"}},[t.data.children&&t.data.children.length?a("svg",{staticClass:"icon vm cp trans",style:t.displayChildren?"":"transform: rotate(-90deg);",on:{click:function(e){return e.stopPropagation(),t.toggle(e)}}},[a("use",{attrs:{"xlink:href":"#arrow-down"}})]):t._e(),a("span",{directives:[{name:"tooltip",rawName:"v-tooltip:bottom",value:{content:t.data.endpointName,popperCls:["trace-table-tooltip"]},expression:"{ content: data.endpointName, popperCls: ['trace-table-tooltip'] }",arg:"bottom"}]},[t._v("\n        "+t._s(t.data.endpointName)+"\n      ")])]),a("div",{staticClass:"start-time"},[t._v("\n      "+t._s(t._f("dateformat")(t.data.startTime))+"\n    ")]),a("div",{staticClass:"exec-ms"},[t._v("\n      "+t._s(t.data.endTime-t.data.startTime?t.data.endTime-t.data.startTime:"0")+"\n    ")]),a("div",{staticClass:"exec-percent"},[a("div",{staticClass:"outer-progress_bar",style:{width:t.outterPercent}},[a("div",{staticClass:"inner-progress_bar",style:{width:t.innerPercent}})])]),a("div",{staticClass:"self"},[t._v("\n      "+t._s(t.data.dur?t.data.dur+"":"0")+"\n    ")]),a("div",{staticClass:"api"},[a("span",{directives:[{name:"tooltip",rawName:"v-tooltip:bottom",value:t.data.component||"-",expression:"data.component || '-'",arg:"bottom"}]},[t._v(t._s(t.data.component||"-"))])]),a("div",{staticClass:"application"},[a("span",{directives:[{name:"tooltip",rawName:"v-tooltip:bottom",value:t.data.serviceCode||"-",expression:"data.serviceCode || '-'",arg:"bottom"}]},[t._v(t._s(t.data.serviceCode))])]),a("div",{directives:[{name:"show",rawName:"v-show",value:"profile"===t.type,expression:"type === 'profile'"}],staticClass:"application"},[a("span",{on:{click:t.viewSpanDetail}},[t._v(t._s(t.$t("view")))])])]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.data.children&&t.data.children.length>0&&t.displayChildren,expression:"data.children && data.children.length > 0 && displayChildren"}],staticClass:"children-trace"},t._l(t.data.children,function(e,n){return a("item",{key:n,attrs:{method:t.method,data:e,type:t.type}})}),1)])},[],!1,null,"707e3dce",null).exports},name:"TraceContainer",props:["type","tableData"],data:function(){return{method:300}},created:function(){this.data="profile"===this.type?u:h},mounted:function(){var t=this;this.$refs.dragger.onmousedown=function(e){var a=e.clientX,n=t.method;document.onmousemove=function(e){var s=e.clientX-a;t.method=n+s},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}}}},g=(a("798f"),Object(v.a)(f,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"trace"},[a("div",{staticClass:"trace-header"},[a("div",{staticClass:"method",style:"width: "+t.method+"px"},[a("span",{ref:"dragger",staticClass:"r cp"},[a("svg",{staticClass:"icon"},[a("use",{attrs:{"xlink:href":"#settings_ethernet"}})])]),t._v("\n      "+t._s(t.data[0].value)+"\n    ")]),t._l(t.data.slice(1),function(e,n){return a("div",{key:n,class:e.label},[t._v("\n      "+t._s(e.value)+"\n    ")])})],2),t._l(t.tableData,function(e,n){return a("Item",{key:"key"+n,attrs:{method:t.method,data:e,type:t.type}})}),t._t("default")],2)},[],!1,null,"791945d8",null).exports),b=a("2ef0"),y=a.n(b),_={components:{TraceContainer:g,TraceSpanLogs:a("d003").a},props:["data","traceId","showBtnDetail","HeaderType"],watch:{data:function(t,e){this.data.length?(this.tableData=this.formatData(this.changeTree()),this.loading=!1):this.tableData=[]}},data:function(){return{tableData:[],diaplay:!0,showDetail:!1,list:[],currentSpan:[],loading:!0}},methods:{copy:p.a,formatData:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=!0,s=!1,r=void 0;try{for(var i,c=d()(t);!(n=(i=c.next()).done);n=!0){var o=i.value;o.level=e,a=a||o.endTime-o.startTime,o.totalExec=a,o.children&&o.children.length>0&&this.formatData(o.children,e+1,a)}}catch(t){s=!0,r=t}finally{try{n||null==c.return||c.return()}finally{if(s)throw r}}return t},traverseTree:function(t,e,a,n){if(t&&!t.isBroken)if(t.spanId!==e||t.segmentId!==a){if(t.children&&t.children.length>0){var s=!0,r=!1,i=void 0;try{for(var c,o=d()(t.children);!(s=(c=o.next()).done);s=!0){var l=c.value;this.traverseTree(l,e,a,n)}}catch(t){r=!0,i=t}finally{try{s||null==o.return||o.return()}finally{if(r)throw i}}}}else t.children.push(n)},changeTree:function(){var t=this;if(0===this.data.length)return[];this.list=o()(new i.a(this.data.map(function(t){return t.serviceCode}))),this.segmentId=[];var e={},a=[],r=[],c=[];for(var l in this.data.forEach(function(e){if(-1===e.parentSpanId)c.push(e);else{var a=t.data.findIndex(function(t){return t.segmentId===e.segmentId&&t.spanId===e.spanId-1}),n={traceId:e.traceId,segmentId:e.segmentId,spanId:e.spanId-1,parentSpanId:e.spanId-2};-1!==a||y.a.find(r,n)||r.push(Object(s.a)({},n,{refs:[],endpointName:"VNode: ".concat(e.segmentId),serviceCode:"VirtualNode",type:"[Broken] ".concat(e.type),peer:"",component:"VirtualNode: #".concat(e.spanId-1),isError:!0,isBroken:!0,layer:"Broken",tags:[],logs:[]}))}}),c.forEach(function(e){e.refs&&e.refs.length&&e.refs.forEach(function(e){if(-1===t.data.findIndex(function(t){return e.parentSegmentId===t.segmentId&&e.parentSpanId===t.spanId})){var a=e.parentSpanId,n={traceId:e.traceId,segmentId:e.parentSegmentId,spanId:a,parentSpanId:a>-1?0:-1};if(!y.a.find(r,n)&&r.push(Object(s.a)({},n,{refs:[],endpointName:"VNode: ".concat(e.parentSegmentId),serviceCode:"VirtualNode",type:"[Broken] ".concat(e.type),peer:"",component:"VirtualNode: #".concat(a),isError:!0,isBroken:!0,layer:"Broken",tags:[],logs:[]})),n.parentSpanId>-1){var i={traceId:e.traceId,segmentId:e.parentSegmentId,spanId:0,parentSpanId:-1};!y.a.find(r,i)&&r.push(Object(s.a)({},i,{refs:[],endpointName:"VNode: ".concat(e.parentSegmentId),serviceCode:"VirtualNode",type:"[Broken] ".concat(e.type),peer:"",component:"VirtualNode: #0",isError:!0,isBroken:!0,layer:"Broken",tags:[],logs:[]}))}}})}),[].concat(r,Object(n.a)(this.data)).forEach(function(t){t.label=t.endpointName||"no operation name",t.children=[],void 0===e[t.segmentId]?(a.push(t.segmentId),e[t.segmentId]=[],e[t.segmentId].push(t)):e[t.segmentId].push(t)}),a.forEach(function(a){var s=e[a].sort(function(t,e){return e.parentSpanId-t.parentSpanId});s.forEach(function(e){var a=s.findIndex(function(t){return t.spanId===e.parentSpanId});if(-1!==a&&(s[a].isBroken&&-1===s[a].parentSpanId||!s[a].isBroken)&&(s[a].children.push(e),s[a].children.sort(function(t,e){return t.spanId-e.spanId})),e.isBroken){var r,i=y.a.filter(t.data,function(t){return y.a.find(t.refs,{traceId:e.traceId,parentSegmentId:e.segmentId,parentSpanId:e.spanId})});i.length>0&&(r=e.children).push.apply(r,Object(n.a)(i))}}),e[a]=s[s.length-1]}),a.forEach(function(a){e[a].refs&&e[a].refs.forEach(function(n){n.traceId===t.traceId&&t.traverseTree(e[n.parentSegmentId],n.parentSpanId,n.parentSegmentId,e[a])})}),e)(e[l].refs&&0===e[l].refs.length||!e[l].refs)&&this.segmentId.push(e[l]);return this.segmentId.forEach(function(e,a){t.collapse(t.segmentId[a])}),this.segmentId},collapse:function(t){var e=this;if(t.children){var a=t.endTime-t.startTime;t.children.forEach(function(t){a-=t.endTime-t.startTime}),t.dur=a<0?0:a,t.children.forEach(function(t){return e.collapse(t)})}},handleSelectSpan:function(t){this.currentSpan=t,this.showBtnDetail||(this.showDetail=!0),this.$emit("selectSpan",t)},showCurrentSpanDetail:function(t,e){var a=this,n=20.2*e.split("\n").length+10,s=.9*window.innerHeight;n=n>=s?s:n,this.$modal.show("dialog",{title:t,text:'<div style="height:'.concat(n,'px">').concat(e,"</div>"),buttons:[{title:"Copy",handler:function(){a.copy(e)}},{title:"Close"}]})},handleViewSpan:function(t){this.showDetail=!0}},created:function(){this.loading=!0},mounted:function(){var t=this;this.tableData=this.formatData(this.changeTree()),this.loading=!1,this.$eventBus.$on("HANDLE-SELECT-SPAN",this,this.handleSelectSpan),this.$eventBus.$on("HANDLE-VIEW-SPAN",this,this.handleViewSpan),this.$eventBus.$on("TRACE-TABLE-LOADING",this,function(){t.loading=!0})}},C=(a("2ab8"),a("f723"),Object(v.a)(_,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"trace-detail-chart-table"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}],staticClass:"rk-trace-t-loading"},[a("svg",{staticClass:"icon loading"},[a("use",{attrs:{"xlink:href":"#spinner"}})])]),a("TraceContainer",{attrs:{tableData:t.tableData,type:t.HeaderType}},[t.tableData.length?t._e():a("div",{staticClass:"trace-tips"},[t._v(t._s(t.$t("noData")))])]),a("rk-sidebox",{attrs:{width:"50%",show:t.showDetail,title:t.$t("spanInfo")},on:{"update:show":function(e){t.showDetail=e}}},[a("TraceSpanLogs",{attrs:{currentSpan:t.currentSpan}})],1)],1)},[],!1,null,null,null).exports);a.d(e,"a",function(){return C})},"5c3b":function(t,e,a){},"798f":function(t,e,a){"use strict";var n=a("d8a2");a.n(n).a},"8faf":function(t,e,a){},"9c62":function(t,e,a){"use strict";var n=a("5c3b");a.n(n).a},d003:function(t,e,a){"use strict";a("28a5");var n=a("d225"),s=a("b0b4"),r=a("308d"),i=a("6bb5"),c=a("4e2b"),o=a("9ab4"),l=a("1b40"),d=a("2ff4"),p=a("4bb5"),u=a("d0ab"),h=function(t){function e(){var t;return Object(n.a)(this,e),(t=Object(r.a)(this,Object(i.a)(e).apply(this,arguments))).showRelatedLogs=!1,t.copy=u.a,t.pageNum=1,t.pageSize=10,t}return Object(c.a)(e,t),Object(s.a)(e,[{key:"getTaceLogs",value:function(){this.showRelatedLogs=!0,this.GET_TRACE_SPAN_LOGS({condition:{relatedTrace:{traceId:this.currentSpan.traceId,segmentId:this.currentSpan.segmentId,spanId:this.currentSpan.spanId},paging:{pageNum:this.pageNum,pageSize:this.pageSize,needTotal:!0}}})}},{key:"turnPage",value:function(t){this.pageNum=t,this.getTaceLogs()}},{key:"showCurrentSpanDetail",value:function(t,e){var a=this,n=20.2*e.split("\n").length+10,s=.9*window.innerHeight;n=n>=s?s:n,this.$modal.show("dialog",{title:t,text:'<div style="height:'.concat(n,'px">').concat(e,"</div>"),buttons:[{title:"Copy",handler:function(){a.copy(e)}},{title:"Close"}]})}}]),e}(l.d);o.a([Object(p.d)("rocketTrace")],h.prototype,"rocketTrace",void 0),o.a([Object(p.a)("rocketTrace/GET_TRACE_SPAN_LOGS")],h.prototype,"GET_TRACE_SPAN_LOGS",void 0),o.a([Object(l.b)()],h.prototype,"currentSpan",void 0);var m=h=o.a([Object(l.a)({components:{LogServiceDetail:d.a}})],h),v=a("2877"),f=Object(v.a)(m,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"rk-trace-detail"},[a("h5",{staticClass:"mb-15"},[t._v(t._s(t.$t("tags"))+".")]),a("div",{staticClass:"mb-10 clear"},[a("span",{staticClass:"g-sm-4 grey"},[t._v(t._s(t.$t("service"))+":")]),a("span",{staticClass:"g-sm-8 wba"},[t._v(t._s(this.currentSpan.serviceCode))])]),a("div",{staticClass:"mb-10 clear"},[a("span",{staticClass:"g-sm-4 grey"},[t._v(t._s(t.$t("serviceinstance"))+":")]),a("span",{staticClass:"g-sm-8 wba"},[t._v(t._s(this.currentSpan.serviceInstanceName))])]),a("div",{staticClass:"mb-10 clear"},[a("span",{staticClass:"g-sm-4 grey"},[t._v(t._s(t.$t("endpoint"))+":")]),a("span",{staticClass:"g-sm-8 wba"},[t._v(t._s(this.currentSpan.label))])]),a("div",{staticClass:"mb-10 clear"},[a("span",{staticClass:"g-sm-4 grey"},[t._v(t._s(t.$t("spanType"))+":")]),a("span",{staticClass:"g-sm-8 wba"},[t._v(t._s(this.currentSpan.type))])]),a("div",{staticClass:"mb-10 clear"},[a("span",{staticClass:"g-sm-4 grey"},[t._v(t._s(t.$t("component"))+":")]),a("span",{staticClass:"g-sm-8 wba"},[t._v(t._s(this.currentSpan.component))])]),a("div",{staticClass:"mb-10 clear"},[a("span",{staticClass:"g-sm-4 grey"},[t._v("Peer:")]),a("span",{staticClass:"g-sm-8 wba"},[t._v(t._s(this.currentSpan.peer||"No Peer"))])]),a("div",{staticClass:"mb-10 clear"},[a("span",{staticClass:"g-sm-4 grey"},[t._v(t._s(t.$t("error"))+":")]),a("span",{staticClass:"g-sm-8 wba"},[t._v(t._s(this.currentSpan.isError))])]),t._l(this.currentSpan.tags,function(e){return a("div",{key:e.key,staticClass:"mb-10 clear"},[a("span",{staticClass:"g-sm-4 grey"},[t._v(t._s(e.key)+":")]),a("span",{staticClass:"g-sm-8 wba"},[t._v("\n        "+t._s(e.value)+"\n        "),"db.statement"===e.key?a("svg",{staticClass:"icon vm grey link-hover cp ml-5",on:{click:function(a){return t.copy(e.value)}}},[a("use",{attrs:{"xlink:href":"#review-list"}})]):t._e()])])}),this.currentSpan.logs?a("h5",{directives:[{name:"show",rawName:"v-show",value:this.currentSpan.logs.length,expression:"this.currentSpan.logs.length"}],staticClass:"mb-10"},[t._v(t._s(t.$t("logs"))+".")]):t._e(),t._l(this.currentSpan.logs,function(e,n){return a("div",{key:n},[a("div",{staticClass:"mb-10 sm"},[a("span",{staticClass:"mr-10"},[t._v(t._s(t.$t("time"))+":")]),a("span",{staticClass:"grey"},[t._v(t._s(t._f("dateformat")(e.time)))])]),t._l(e.data,function(e,n){return a("div",{key:n,staticClass:"mb-15 clear"},[a("div",{staticClass:"mb-10"},[t._v("\n          "+t._s(e.key)+":"),"stack"===e.key?a("span",{staticClass:"r rk-sidebox-magnify",on:{click:function(a){return t.showCurrentSpanDetail(e.key,e.value)}}},[a("svg",{staticClass:"icon"},[a("use",{attrs:{"xlink:href":"#magnify"}})])]):t._e()]),a("pre",{staticClass:"pl-15 mt-0 mb-0 sm oa"},[t._v(t._s(e.value))])])})],2)}),a("div",{on:{click:function(e){return t.getTaceLogs()}}},[a("a",{staticClass:"rk-popup-btn bg-blue r"},[a("span",{staticClass:"mr-5 vm"},[t._v("\n          "+t._s(t.$t("relatedTraceLogs"))+"\n        ")])])])],2),a("rk-sidebox",{attrs:{width:"100%",show:t.showRelatedLogs,title:t.$t("relatedTraceLogs")},on:{"update:show":function(e){t.showRelatedLogs=e}}},[a("div",[a("RkPage",{attrs:{currentSize:t.pageSize,currentPage:t.pageNum,total:t.rocketTrace.traceSpanLogsTotal},on:{changePage:t.turnPage}}),a("LogServiceDetail",{attrs:{data:t.rocketTrace.traceSpanLogs||[],loading:!1,noLink:!0}})],1)])],1)},[],!1,null,null,null);e.a=f.exports},d0ab:function(t,e,a){"use strict";var n=a("1b40");e.a=function(t){var e=document.createElement("input");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("Copy")&&document.execCommand("Copy"),e.remove(),n.d.prototype.$noty.success("Copied!",{timeout:500})}},d8a2:function(t,e,a){},f723:function(t,e,a){"use strict";var n=a("35d2");a.n(n).a}}]);